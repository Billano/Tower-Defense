'use strict';

var killAllBots = require('./killAllBots.js');
var newFiringRange = require('./newFiringRange.js');
var createBots = require('./createBots.js');
var _ = require('lodash');

//wins the game
function winGame(lines, firingRange, bots) {
  var turn;

  //try to beat it with the current firing range
  console.log("Firing range is " + firingRange + "m");
  turn = killAllBots(firingRange, bots, true);
  //checks if the tower manage to kill all the enemies
  if (bots.length == 0) {
    console.log("You win in " + turn + " turns");
  } else {
    //if the tower couldnt kill all the enemies, we find the new firing range
    firingRange = newFiringRange(firingRange + 1, _.drop(lines));
    console.log("You lost, " + bots[0][0] + " killed you, the minimun fire"
    + "range needed to win is " + firingRange + "m");
    console.log(firingRange + "m");
    //kills all the enemies with the new firing range
    turn = killAllBots(firingRange, createBots(_.drop(lines)), true);
    console.log("You win in " + turn + " turns");
  }
}

module.exports = winGame;
