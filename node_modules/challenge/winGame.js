'use strict';

var killAllBots = require('./killAllBots.js');
var newFiringRange = require('./newFiringRange.js');
var createBots = require('./createBots.js');
var possibleToWin = require('./possibleToWin.js');
var _ = require('lodash');

//wins the game
function winGame(lines, firingRange, bots) {
  var turn;

  //try to beat it with the current firing range
  console.log("Firing range is " + firingRange + "m");
  turn = killAllBots(firingRange, bots, true);
  //checkss if the tower could kill all the enemies
  if (bots.length == 0) {
    console.log("You win in " + turn + " turns");
  } else {
    console.log("You lost, " + bots[0][0] + " killed you!");
    bots = createBots(_.drop(lines));
    //checks if we can beat the game with the current enemies
    if (possibleToWin(bots)) {
      //if the tower couldnt kill all the enemies, we find the new firing range
      firingRange = newFiringRange(firingRange + 1, _.drop(lines));
      console.log("the minimun fire range needed to win is "
      + firingRange + "m");
      console.log(firingRange + "m");
      //kills all the enemies with the new firing range
      turn = killAllBots(firingRange, createBots(_.drop(lines)), true);
      console.log("You win in " + turn + " turns");
    } else {
      console.log("The game is not beatable");
    }

  }
}

module.exports = winGame;
